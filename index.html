<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Daily Recall Quiz with Spaced Repetition</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 650px;
    margin: 30px auto;
    padding: 0 15px;
    background: #f9f9f9;
    color: #222;
  }
  h1 {
    text-align: center;
    color: #004d40;
  }
  .question-box {
    background: white;
    border-radius: 6px;
    box-shadow: 0 0 10px #ccc;
    padding: 20px;
    margin-bottom: 20px;
  }
  .question-text {
    font-size: 1.2em;
    margin-bottom: 15px;
  }
  .options {
    list-style: none;
    padding: 0;
  }
  .options li {
    background: #e0f2f1;
    margin-bottom: 10px;
    padding: 12px;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.3s;
  }
  .options li:hover:not(.disabled) {
    background: #b2dfdb;
  }
  .options li.correct {
    background: #a5d6a7;
    cursor: default;
  }
  .options li.wrong {
    background: #ef9a9a;
    cursor: default;
  }
  .options li.disabled {
    pointer-events: none;
  }
  button {
    background: #00796b;
    border: none;
    color: white;
    padding: 12px 25px;
    font-size: 1em;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px;
  }
  button:disabled {
    background: #ccc;
    cursor: default;
  }
  .score-box {
    background: #c8e6c9;
    padding: 20px;
    border-radius: 6px;
    text-align: center;
    font-size: 1.3em;
    color: #2e7d32;
  }
  .review {
    margin-top: 15px;
    font-size: 0.95em;
    color: #555;
    background: #fff3e0;
    padding: 10px;
    border-left: 5px solid #ffa726;
  }
  .review-tag {
    display: inline-block;
    background: #ffcc80;
    color: #5d4037;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 0.85em;
    margin-left: 10px;
  }
</style>
</head>
<body>

<h1>Daily Recall Quiz Demo</h1>

<div id="quiz-container" class="question-box"></div>

<button id="next-btn" disabled>Next Question</button>

<div id="score-container" style="display:none;" class="score-box"></div>

<script>
  // Sample question bank
  const questions = [
    {
      id: 1,
      chapter: "Cell",
      question: "What is the basic unit of life?",
      options: ["Atom", "Cell", "Molecule", "Organ"],
      answer: "Cell",
      explanation: "The cell is the smallest unit of life that can perform all life processes."
    },
    {
      id: 2,
      chapter: "Blood",
      question: "Which blood cells help in clotting?",
      options: ["Red Blood Cells", "White Blood Cells", "Platelets", "Plasma"],
      answer: "Platelets",
      explanation: "Platelets help stop bleeding by forming clots."
    },
    {
      id: 3,
      chapter: "Respiration",
      question: "Where does gas exchange occur in the lungs?",
      options: ["Bronchi", "Alveoli", "Trachea", "Diaphragm"],
      answer: "Alveoli",
      explanation: "Alveoli are tiny air sacs where oxygen and carbon dioxide are exchanged."
    },
    {
      id: 4,
      chapter: "Genetics",
      question: "DNA stands for?",
      options: ["Deoxyribonucleic Acid", "Dinucleic Acid", "Dioxynucleic Acid", "None"],
      answer: "Deoxyribonucleic Acid",
      explanation: "DNA is the molecule that carries genetic instructions."
    },
    {
      id: 5,
      chapter: "Heart",
      question: "Which chamber of the heart pumps oxygenated blood to the body?",
      options: ["Right Atrium", "Left Atrium", "Right Ventricle", "Left Ventricle"],
      answer: "Left Ventricle",
      explanation: "The left ventricle pumps oxygen-rich blood to the entire body."
    }
  ];

  // Spaced repetition intervals in days
  const reviewIntervals = [2, 4, 7, 15, 30, 50];

  // LocalStorage key
  const STORAGE_KEY = "wrongQuestionsData";

  // Load wrong questions data from localStorage
  let wrongQuestionsData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

  let dailyQuestions = [];
  let currentIndex = 0;
  let score = 0;
  let wrongThisSession = [];

  const quizContainer = document.getElementById("quiz-container");
  const nextBtn = document.getElementById("next-btn");
  const scoreContainer = document.getElementById("score-container");

  // Fisher-Yates shuffle
  function shuffleArray(arr) {
    for(let i=arr.length-1; i>0; i--) {
      const j = Math.floor(Math.random()*(i+1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
  }

  // Add wrong question to storage with spaced repetition schedule
  function addWrongQuestion(questionId) {
    const now = new Date().toISOString();

    // Avoid duplicate
    if(wrongQuestionsData.find(q => q.questionId === questionId)) return;

    // Calculate review dates
    const reviewDates = reviewIntervals.map(days => {
      const d = new Date();
      d.setDate(d.getDate() + days);
      return d.toISOString();
    });

    wrongQuestionsData.push({
      questionId,
      firstWrongDate: now,
      reviewDates,
      lastReviewedDate: null,
      reviewIndex: 0
    });
    saveWrongQuestions();
  }

  // Save to localStorage
  function saveWrongQuestions() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(wrongQuestionsData));
  }

  // Get IDs of questions due for review today or earlier
  function getDueReviewQuestions() {
    const today = new Date();

    return wrongQuestionsData
      .filter(q => {
        const nextReviewDateStr = q.reviewDates[q.reviewIndex];
        if(!nextReviewDateStr) return false;
        return today >= new Date(nextReviewDateStr);
      })
      .map(q => q.questionId);
  }

  // Mark question reviewed: update reviewIndex and lastReviewedDate
  function markQuestionReviewed(questionId) {
    const q = wrongQuestionsData.find(q => q.questionId === questionId);
    if(!q) return;
    q.reviewIndex++;
    q.lastReviewedDate = new Date().toISOString();

    // Remove if all reviews done
    if(q.reviewIndex >= reviewIntervals.length){
      wrongQuestionsData = wrongQuestionsData.filter(item => item.questionId !== questionId);
    }

    saveWrongQuestions();
  }

  // Prepare today's questions:
  // 1. Review questions due today (prioritized)
  // 2. Then random new questions from question bank (not in review)
  function prepareDailyQuestions() {
    const dueReviewIds = getDueReviewQuestions();
    let reviewQs = questions.filter(q => dueReviewIds.includes(q.id));
    let reviewIdsSet = new Set(dueReviewIds);

    // Pick new questions excluding those in review
    let newQs = questions.filter(q => !reviewIdsSet.has(q.id));

    shuffleArray(newQs);

    // For demo, total 5 questions per day, mix review + new
    let totalNeeded = 5;
    let combined = [...reviewQs];

    for(let i=0; i<newQs.length && combined.length < totalNeeded; i++) {
      combined.push(newQs[i]);
    }

    shuffleArray(combined);
    return combined;
  }

  function showQuestion() {
    nextBtn.disabled = true;
    quizContainer.innerHTML = "";

    if(currentIndex >= dailyQuestions.length){
      showScore();
      return;
    }

    const q = dailyQuestions[currentIndex];

    const questionEl = document.createElement("div");
    questionEl.classList.add("question-text");

    // Mark if review question
    let isReview = getDueReviewQuestions().includes(q.id);
    questionEl.innerHTML = `Q${currentIndex + 1}. ${q.question} ` + 
      (isReview ? '<span class="review-tag">Review</span>' : '');

    quizContainer.appendChild(questionEl);

    const ul = document.createElement("ul");
    ul.classList.add("options");

    q.options.forEach(option => {
      const li = document.createElement("li");
      li.textContent = option;
      li.addEventListener("click", () => selectOption(li, q));
      ul.appendChild(li);
    });

    quizContainer.appendChild(ul);
  }

  function selectOption(selectedLi, question) {
    const allOptions = quizContainer.querySelectorAll(".options li");
    allOptions.forEach(li => {
      li.classList.add("disabled");
      li.removeEventListener("click", () => selectOption);
      if(li === selectedLi){
        if(li.textContent === question.answer){
          li.classList.add("correct");
          score++;
          // If this question was in review, mark reviewed
          if(getDueReviewQuestions().includes(question.id)){
            markQuestionReviewed(question.id);
          }
        } else {
          li.classList.add("wrong");
          addWrongQuestion(question.id);
          wrongThisSession.push(question);
        }
      } else {
        if(li.textContent === question.answer){
          li.classList.add("correct");
        }
      }
    });

    // Show explanation for wrong or correct answer
    const explanation = document.createElement("div");
    explanation.classList.add("review");
    explanation.textContent = `Explanation: ${question.explanation}`;
    quizContainer.appendChild(explanation);

    nextBtn.disabled = false;
  }

  nextBtn.addEventListener("click", () => {
    currentIndex++;
    showQuestion();
  });

  function showScore() {
    quizContainer.style.display = "none";
    nextBtn.style.display = "none";
    scoreContainer.style.display = "block";
    scoreContainer.innerHTML = `<strong>Your Score:</strong> ${score} / ${dailyQuestions.length}`;

    if(wrongThisSession.length > 0){
      let reviewHTML = `<p><strong>Review these topics again:</strong></p><ul>`;
      wrongThisSession.forEach(q => {
        reviewHTML += `<li>${q.chapter} - ${q.question}</li>`;
      });
      reviewHTML += `</ul>`;
      scoreContainer.innerHTML += reviewHTML;
    }
  }

  // Initialize
  dailyQuestions = prepareDailyQuestions();
  showQuestion();

</script>

</body>
</html>
